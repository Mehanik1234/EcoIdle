<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Idle Game</title>

<style>
body {
    margin: 0;
    height: 100vh;
    padding: 250px 20px;
    background-color: rgb(90, 90, 90);
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: Arial, sans-serif;
    color: white;
    transition: background-color 1s;
}

body.clean {
    background-color: #5a8f5a;
}

body.lesspolluted {
    background-color: #658f2a;
}

body.polluted {
    background-color: #7a7a3a;
}

body.lessdirty {
    background-color: #7a613a;
}
body.dirty {
    background-color: #5f4a3a;
}

body.toxic {
    background-color: #3a3a3a;
}
body.dead {
    background-color: rgb(34, 34, 34);
}

.game {
    background: #2e2e2e;
    padding: 45px;
    border-radius: 12px;
    width: 300px;
    text-align: center;
    background: linear-gradient(145deg, #2e2e2e, #3a3a3a);
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    padding: 45px;
    border-radius: 20px;
}

.resource {
    font-size: 18px;
    margin: 6px 0;
}

button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    border: none;
    border-radius: 8px;
    font-size: 15px;
    cursor: pointer;
    background: #4caf50;
    color: white;
}

button:disabled {
    background: #777;
    cursor: not-allowed;
}

.box {
    background: #2e2e2e;
    padding: 25px;
    border-radius: 12px;
    width: 300px;
    text-align: center;
}

.button-grid {
    display: grid;
    grid-template-columns: 1fr 1fr  ; /* –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ */
    gap: 5px;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥—ã–º–∞ */
#smoke {
    position: fixed;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    z-index: 999;
    display: none;
}

/* –û–¥–Ω–∞ —á–∞—Å—Ç–∏—Ü–∞ –¥—ã–º–∞ */
.smoke-particle {
    position: absolute;
    bottom: -100px;
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, rgba(180,180,180,0.35) 0%, rgba(180,180,180,0.15) 40%, transparent 70%);
    border-radius: 50%;
    animation: smokeRise linear infinite;
    filter: blur(8px);
}

@keyframes smokeRise {
    0% {
        transform: translateY(0) translateX(0) scale(0.8);
        opacity: 0.6;
    }
    100% {
        transform: translateY(-120vh) translateX(200px) scale(1.8);
        opacity: 0;
    }
}


</style>
</head>

<body>

<div class="game">
    <h1>Idle Game</h1>

    <div class="resource">üí∞ Coins: <span id="coins">0</span></div>
    <div class="resource">üå´ Pollution: <span id="pollution">0</span></div>
    <div class="resource">üìÖ Days: <span id="days">0</span></div>
    <div class="resource">population: <span id="population">1000</span></div>  
    <div class="resource">population growth: <span id="populationPS">50</span></div>  
    <div class="resource">Fines: <span id="minuscoins">10</span></div>
    <div class="resource">Coins: +<span id="perSecond">0</span>/sec</div>
    <div class="resource">Pollution: +<span id="pollutionPerSec">0</span>/tick</div>
    <div class="resource">pollution reduction: -<span id="pollutionReduction">0</span>/tick</div>

    <button onclick="clickCoin()">Click</button>

    <div class="button-grid">
        <button onclick="buyUpgrade()" id="upgradeBtn">Small Market (+1/sec) - <span id="upgradeCost">10</span></button>
        <button onclick="buyMarket()" id="MarketBtn">Medium Market (+2/sec) - <span id="MarketCost">15</span></button>
        <button onclick="buyBigMarket()" id="BMarketBtn">Big Market (+4/sec) - <span id="BMarketCost">100</span></button>
        <button onclick="buyCoal()" id="CoalBtn">Coal Power Plant (+8/sec) - <span id="CoalCost">150</span></button>
        <button onclick="buySFactory()" id="SfactoryBtn">Small Factory (+10/sec) - <span id="SfactoryCost">300</span></button>
        <button onclick="buyMFactory()" id="MfactoryBtn">Medium Factory (+20/sec) - <span id="MfactoryCost">500</span></button>
        <button onclick="buyBFactory()" id="BfactoryBtn">Big Factory (+40/sec) - <span id="BfactoryCost">800</span></button>
        <button onclick="buyOil()" id="OilBtn">Oil Refinery (+60/sec) - <span id="OilCost">800</span></button>
        <button onclick="buyNuclear()" id="NuclearBtn">Nuclear power plant (+100/sec) - <span id="NuclearCost">3000</span></button>
        <button onclick="buyNuclear2()" id="Nuclear2Btn">Antimatter Reactor(+300/sec) - <span id="Nuclear2Cost">6000</span></button>
        <button onclick="buyPlusCoins()" id="pCoinsBtn">Reduce fines (-5) - <span id="pCoinsCost">200</span></button>
        <button onclick="buyMP()" id="MPBtn">Pollution treatment plant (-1 pollution) - <span id="MPCost">500</span></button>
        <button onclick="buyMP2()" id="MPBtn2">Environmental Cleanup Facility (-2 pollution) - <span id="MPCost2">800</span></button>
        <button onclick="buyMP3()" id="MPBtn3">Planetary Cleanser (-5 pollution) - <span id="MPCost3">1100</span></button>
    </div>

    <button onclick="resetSave()">Reset Save</button>

    <div id="smoke"></div>
    
</div>

<script>
let coins = 1;
let days = 0;
let minuscoins = 10;

// income
let cps1 = 1, cps2 = 0, cps3 = 0, cps4 = 0, cps5 = 0, cps6 = 0, cps7 = 0, cps8 = 0, cps9 = 0, cps10 = 0;

let allowSave = true;

// pollution
let pollution = 0;
let pollutionPerSecond = 0;
let pollutionReduction = 0;
let pollutionLevel = 0;

//population
let population = 1000;
let basePopulationPS = 50;
let populationPS = basePopulationPS;

//building
let smallFactories = 0;
let mediumFactories = 0;
let CoalPlants = 0;
let bigFactories = 0;
let oilCount = 0;
let Nuclears = 0;
let incomeMultiplier = 1; 
 
// costs
let upgradeCost = 10;
let MarketCost = 15;
let BMarketCost = 100;
let CoalCost = 150;
let SfactoryCost = 300;
let MfactoryCost = 500;
let BfactoryCost = 800;
let OilCost = 1000;
let NuclearCost = 3000;
let Nuclear2Cost = 6000;
let pCoinsCost = 200;
let MPCost = 500;
let MPCost2 = 800
let MPCost3 = 1100

// click
function clickCoin() {
    coins++;
    updateUI();
}

// upgrades
function buyUpgrade() {
    if (coins >= upgradeCost) {
        coins -= upgradeCost;
        cps1 += 1;
        basePopulationPS++;
        upgradeCost = Math.floor(upgradeCost * 1.12);
        updateUI();
    }
}

function buyMarket() {
    if (coins >= MarketCost) {
        coins -= MarketCost;
        cps2 += 2;
        basePopulationPS++;
        MarketCost = Math.floor(MarketCost * 1.1);
        updateUI();
    }
}

function buyBigMarket() {
    if (coins >= BMarketCost) {
        coins -= BMarketCost;
        cps3 += 4;
        basePopulationPS++;
        BMarketCost = Math.floor(BMarketCost * 1.09);
        updateUI();
    }
}

function buyCoal() {
    if (coins >= CoalCost) {
        coins -= CoalCost;
        CoalPlants++;
        cps9 = CoalPlants * 8;
        pollutionPerSecond += 0.5;
        CoalCost = Math.floor(CoalCost * 1.09);
        updateUI();
    }
}

function buySFactory() {
    if (coins >= SfactoryCost) {
        coins -= SfactoryCost;
        smallFactories++;
        cps4 = smallFactories * 10;
        pollutionPerSecond += 1;
        SfactoryCost = Math.floor(SfactoryCost * 1.09);
        updateUI();
    }
}

function buyMFactory() {
    if (coins >= MfactoryCost) {
        coins -= MfactoryCost;
        mediumFactories++;
        cps5 = mediumFactories * 20;
        pollutionPerSecond += 2;
        MfactoryCost = Math.floor(MfactoryCost * 1.09);
        updateUI();
    }
}

function buyBFactory() {
    if (coins >= BfactoryCost) {
        coins -= BfactoryCost;
        bigFactories++;
        cps6 = bigFactories * 40
        pollutionPerSecond += 3;
        BfactoryCost = Math.floor(BfactoryCost * 1.1);
        updateUI();
    }
}

function buyOil() {
    if (coins >= OilCost) {
        coins -= OilCost;

        oilCount++;
        cps10 = oilCount * 60;

        incomeMultiplier += 0.01; // +1% –∫ –æ–±—â–µ–º—É –¥–æ—Ö–æ–¥—É

        pollutionPerSecond += 6;
        OilCost = Math.floor(OilCost * 1.2);
        updateUI();
    }
}


function buyNuclear() {
    if (coins >= NuclearCost) {
        coins -= NuclearCost;
        Nuclears++;
        cps7 = Nuclears * 100;
        pollutionPerSecond += 5;
        NuclearCost = Math.floor(NuclearCost * 1.09);
        updateUI();
    }
}

function buyNuclear2() {
    if (coins >= Nuclear2Cost) {
        coins -= Nuclear2Cost;
        cps8 += 300;
        pollutionPerSecond += 10;
        Nuclear2Cost = Math.floor(Nuclear2Cost * 1.07);
        updateUI();
    }
}

function buyPlusCoins() {
    if (coins >= pCoinsCost) {
        coins -= pCoinsCost;
        minuscoins = Math.max(0, minuscoins - 5);
        pCoinsCost = Math.floor(pCoinsCost * 1.2);
        updateUI();
    }
}

function buyMP() {
    if (coins >= MPCost) {
        coins -= MPCost;
        pollutionReduction += 1;
        pollution -= 1; 
        if (pollution < 0) pollution = 0;
        MPCost = Math.floor(MPCost * 1.1);
        updateUI();
    }
}

function buyMP2() {
    if (coins >= MPCost2) {
        coins -= MPCost2;
        pollutionReduction += 2;
        pollution -= 2; 
        if (pollution < 0) pollution = 0;
        MPCost2 = Math.floor(MPCost2 * 1.1);
        updateUI();
    }
}

function buyMP3() {
    if (coins >= MPCost3) {
        coins -= MPCost3;
        pollutionReduction += 5;
        pollution -= 5; 
        if (pollution < 0) pollution = 0;
        MPCost3 = Math.floor(MPCost3 * 1.1);
        updateUI();
    }
}

function resetSave() {
    if (confirm("Delete save?")) {
        allowSave = false;
        localStorage.removeItem("idleGameSave");
        location.reload();
    }
}

function loadGame() {
    const save = JSON.parse(localStorage.getItem("idleGameSave"));
    if (!save) return;

    coins = save.coins ?? coins;
    days = save.days ?? days;
    minuscoins = save.minuscoins ?? minuscoins;
    basePopulationPS = save.basePopulationPS ?? basePopulationPS;
    populationPS = basePopulationPS;

    cps1 = save.cps1 ?? cps1;
    cps2 = save.cps2 ?? cps2;
    cps3 = save.cps3 ?? cps3;
    cps4 = save.cps4 ?? cps4;
    cps5 = save.cps5 ?? cps5;
    cps6 = save.cps6 ?? cps6;
    cps7 = save.cps7 ?? cps7;
    cps8 = save.cps8 ?? cps8;
    cps9 = save.cps9 ?? cps9;
    cps10 = save.cps10 ?? cps10

    pollution = save.pollution ?? pollution;
    pollutionPerSecond = save.pollutionPerSecond ?? pollutionPerSecond;
    pollutionReduction = save.pollutionReduction ?? pollutionReduction;
    pollutionLevel = save.pollutionLevel ?? pollutionLevel;

    smallFactories = save.smallFactories ?? smallFactories;
    mediumFactories = save.mediumFactories ?? mediumFactories;
    CoalPlants = save.CoalPlants ?? CoalPlants;
    bigFactories = save.bigFactories ?? bigFactories;
    oilCount = save.oilCount ?? oilCount;
    incomeMultiplier = save.incomeMultiplier ?? incomeMultiplier;
    Nuclears = save.Nuclears ?? Nuclears;

    upgradeCost = save.upgradeCost ?? upgradeCost;
    MarketCost = save.MarketCost ?? MarketCost;
    BMarketCost = save.BMarketCost ?? BMarketCost;
    CoalCost = save.CoalCost ?? CoalCost;
    SfactoryCost = save.SfactoryCost ?? SfactoryCost;
    MfactoryCost = save.MfactoryCost ?? MfactoryCost;
    BfactoryCost = save.BfactoryCost ?? BfactoryCost;
    OilCost = save.OilCost ?? OilCost;
    NuclearCost = save.NuclearCost ?? NuclearCost;
    Nuclear2Cost = save.Nuclear2Cost ?? Nuclear2Cost;
    pCoinsCost = save.pCoinsCost ?? pCoinsCost;
    MPCost = save.MPCost ?? MPCost;
    MPCost2 = save.MPCost2 ?? MPCost2;
    MPCost3 = save.MPCost3 ?? MPCost3;
}


// income tick
setInterval(() => {
    const baseIncome =
        cps1 + cps2 + cps3 + cps4 + cps5 +
        cps6 + cps7 + cps8 + cps9 + cps10;

    coins += Math.floor(baseIncome * incomeMultiplier);
    updateUI();
}, 1000);

// pollution tick
setInterval(() => {
    pollution += pollutionPerSecond - pollutionReduction; // —Ñ–∞–±—Ä–∏–∫–∏ –º–∏–Ω—É—Å –æ—á–∏—Å—Ç–∫–∞
    if (pollution < 0) pollution = 0;

    // —É—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –∏ —à—Ç—Ä–∞—Ñ—ã
    let newLevel = Math.floor(pollution / 5);
    if (newLevel > pollutionLevel) {
        minuscoins += (newLevel - pollutionLevel);
        pollutionLevel = newLevel;
    }
    if (pollution >= 100) {
    enableSmoke();
} else {
    disableSmoke();
}

    updateUI();
}, 5000);

// days & fines
setInterval(() => {
    days++;
    if (days % 10 === 0) {
        coins -= minuscoins;
        if (coins < 0) coins = 0;
        minuscoins += 30;
    }
    updateUI();
}, 10000);

 //population
setInterval(() => {
    population += populationPS;
    if (population < 0) population = 0;
    updateUI();
}, 5000);


//random
setInterval(() => {
    let baseChance = 0.02; 
    let extra = (pollution * 0.002) - (pollutionReduction * 0.01);

    let chance = Math.max(0, Math.min(0.5, baseChance + extra));

    if (pollution < 10) {
    chance = 0;
    }
    if (Math.random() < chance) {
        alert("The environment is too polluted! Fine: 1000 coins");
        coins = Math.max(0, coins - 1000);
        updateUI();
    }
}, 5000);


// dont pollute system 1 (–º–∞–ª–µ–Ω—å–∫–∏–µ –∑–∞–≤–æ–¥—ã)
setInterval(() => {
    if (pollution >= 100 && smallFactories > 0) {
        if (Math.random() < 0.8) {
            alert("The government closed one small factory!");
            smallFactories--;
            cps4 = smallFactories * 10;
            pollutionPerSecond = Math.max(0, pollutionPerSecond - 1);
            updateUI();
        }
    }
}, 15000);


// dont pollute system 2 (—Å—Ä–µ–¥–Ω–∏–µ –∑–∞–≤–æ–¥—ã)
setInterval(() => {
    if (pollution >= 200 && mediumFactories > 0) {
        if (Math.random() < 0.8) {
            alert("The government closed one medium factory!");
            mediumFactories--;
            cps5 = mediumFactories * 20;
            pollutionPerSecond = Math.max(0, pollutionPerSecond - 2);
            updateUI();
        }
    }
}, 15000);


// dont pollute system 3 (—É–≥–æ–ª—å–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏)
setInterval(() => {
    if (pollution >= 70 && CoalPlants > 0) {
        if (Math.random() < 0.7) {
            alert("The government closed one Coal Power plant!");
            CoalPlants--;
            cps9 = CoalPlants * 8;
            pollutionPerSecond = Math.max(0, pollutionPerSecond - 0.5);
            updateUI();
        }
    }
},15000);


// dont pollute system 4 (–±–æ–ª—å—à–∏–µ –∑–∞–≤–æ–¥—ã)
setInterval(() => {
    if (pollution >= 250 && bigFactories > 0) {
        if (Math.random() < 0.7) {
            alert("The government closed one big factory!");
            bigFactories--;
            cps6 = bigFactories * 40;
            pollutionPerSecond = Math.max(0, pollutionPerSecond - 3);
            updateUI();
        }
    }
}, 15000);

setInterval(() => {
    if (oilCount <= 0) return;
    if (pollution < 200) return;

    let baseChance = 0.04; // 4%
    let pollutionFactor = (pollution - 200) * 0.0015;
    let reductionFactor = pollutionReduction * 0.02;

    let chance = baseChance + pollutionFactor - reductionFactor;
    chance = Math.max(0, Math.min(0.35, chance)); // –º–∞–∫—Å–∏–º—É–º 35%

    if (Math.random() < chance) {
        alert("The government closed one Oil refinery!");
        oilCount--;

        incomeMultiplier = 1 + oilCount * 0.01;
        cps10 = oilCount * 60;
        pollutionPerSecond = Math.max(0, pollutionPerSecond - 6);

        updateUI();
    }
}, 15000);

setInterval(() => {
    if (pollution >= 300 && Nuclears > 0) {
        if (Math.random() < 0.7) {
            alert("The government closed one Nuclear plant!");
            Nuclears--;
            cps7 = Nuclears * 100;
            pollutionPerSecond = Math.max(0, pollutionPerSecond - 5);
            updateUI();
        }
    }
}, 15000);
//population
setInterval(() => {
    if (pollution < 10) {
        populationPS = basePopulationPS;
    } else if (pollution < 50) {
        populationPS = basePopulationPS - 10;
    } else if (pollution < 100) {
        populationPS = basePopulationPS - 25;
    } else {
        populationPS = -50;
    }
}, 5000);

setInterval(() => {
    // 1000 –Ω–∞—Å–µ–ª–µ–Ω–∏—è = +1%
    incomeMultiplier = 1 + (population / 500) * 0.01;
}, 1000);

function updateBackground() {
    document.body.className = "";

    if (pollution < 15) {
        document.body.classList.add("clean");
    } else if (pollution < 45) {
        document.body.classList.add("lesspolluted");
    } else if (pollution < 80) {
        document.body.classList.add("polluted");
    } else if (pollution < 150) {
        document.body.classList.add("lessdirty");
    } else if (pollution < 300) {
        document.body.classList.add("dirty");
    } else if (pollution < 500){
        document.body.classList.add("toxic");
    } else {
        document.body.classList.add("dead");
    }
}

const smoke = document.getElementById("smoke");
let smokeActive = false;

function enableSmoke() {
    if (smokeActive) return;
    smokeActive = true;
    smoke.style.display = "block";

    for (let i = 0; i < 15; i++) {
        const p = document.createElement("div");
        p.className = "smoke-particle";
        p.style.left = Math.random() * 100 + "vw";
        p.style.animationDuration = 8 + Math.random() * 6 + "s";
        p.style.animationDelay = Math.random() * 5 + "s";
        smoke.appendChild(p);
    }
}

function disableSmoke() {
    smokeActive = false;
    smoke.style.display = "none";
    smoke.innerHTML = "";
}

// UI
function updateUI() {
    document.getElementById("coins").textContent = coins;
    document.getElementById("days").textContent = days;
    document.getElementById("minuscoins").textContent = minuscoins;
    document.getElementById("pollution").textContent = pollution;
    document.getElementById("pollutionReduction").textContent = pollutionReduction;

    document.getElementById("perSecond").textContent =
        cps1 + cps2 + cps3 + cps4 + cps5 + cps6 + cps7 + cps8 + cps9 + cps10;

    document.getElementById("pollutionPerSec").textContent = pollutionPerSecond;

    document.getElementById("upgradeCost").textContent = upgradeCost;
    document.getElementById("MarketCost").textContent = MarketCost;
    document.getElementById("BMarketCost").textContent = BMarketCost;
    document.getElementById("CoalCost").textContent = CoalCost;
    document.getElementById("SfactoryCost").textContent = SfactoryCost;
    document.getElementById("MfactoryCost").textContent = MfactoryCost;
    document.getElementById("BfactoryCost").textContent = BfactoryCost;
    document.getElementById("OilCost").textContent = OilCost;
    document.getElementById("NuclearCost").textContent = NuclearCost;
    document.getElementById("Nuclear2Cost").textContent = Nuclear2Cost;
    document.getElementById("pCoinsCost").textContent = pCoinsCost;
    document.getElementById("MPCost").textContent = MPCost;
    document.getElementById("MPCost2").textContent = MPCost2;
    document.getElementById("MPCost3").textContent = MPCost3;
    document.getElementById("population").textContent = population;
    document.getElementById("populationPS").textContent = populationPS;

    document.getElementById("upgradeBtn").disabled = coins < upgradeCost;
    document.getElementById("MarketBtn").disabled = coins < MarketCost;
    document.getElementById("BMarketBtn").disabled = coins < BMarketCost;
    document.getElementById("CoalBtn").disabled = coins < CoalCost;
    document.getElementById("SfactoryBtn").disabled = coins < SfactoryCost;
    document.getElementById("MfactoryBtn").disabled = coins < MfactoryCost;
    document.getElementById("BfactoryBtn").disabled = coins < BfactoryCost;
    document.getElementById("OilBtn").disabled = coins < OilCost;
    document.getElementById("NuclearBtn").disabled = coins < NuclearCost;
    document.getElementById("Nuclear2Btn").disabled = coins < Nuclear2Cost;
    document.getElementById("pCoinsBtn").disabled = coins < pCoinsCost;
    document.getElementById("MPBtn").disabled = coins < MPCost;
    document.getElementById("MPBtn2").disabled = coins < MPCost2;
    document.getElementById("MPBtn3").disabled = coins < MPCost3;
    updateBackground();

}

loadGame();
function saveGame() {
    if (!allowSave) return;

    const save = {
        coins,
        days,
        minuscoins,
        population,
        basePopulationPS,
        populationPS,
        cps1, cps2, cps3, cps4, cps5, cps6, cps7, cps8, cps9, cps10,
        pollution,
        pollutionPerSecond,
        pollutionReduction,
        pollutionLevel,
        smallFactories,
        mediumFactories,
        CoalPlants,
        bigFactories,
        oilCount,
        Nuclears,
        incomeMultiplier,
        upgradeCost,
        MarketCost,
        BMarketCost,
        CoalCost,
        SfactoryCost,
        MfactoryCost,
        BfactoryCost,
        OilCost,
        NuclearCost,
        Nuclear2Cost,
        pCoinsCost,
        MPCost,
        MPCost2,
        MPCost3
    };

    localStorage.setItem("idleGameSave", JSON.stringify(save));
}

updateUI();

setInterval(saveGame, 5000);
window.addEventListener("beforeunload", saveGame);

</script>
</body>
</html>